# ClaudeNotifier Makefile

PREFIX ?= /Applications
APP_NAME = ClaudeNotifier
APP_BUNDLE = $(APP_NAME).app
INSTALL_DIR = $(PREFIX)/$(APP_BUNDLE)

LSREGISTER = /System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister

.PHONY: all build install uninstall clean help

all: build

build: $(APP_NAME)

$(APP_NAME): src/ClaudeNotifier.swift
	@echo "Compiling $(APP_NAME)..."
	swiftc -O -o $(APP_NAME) src/ClaudeNotifier.swift

install: build
	@echo "Installing to $(INSTALL_DIR)..."
	@mkdir -p $(INSTALL_DIR)/Contents/MacOS
	@mkdir -p $(INSTALL_DIR)/Contents/Resources
	@cp $(APP_NAME) $(INSTALL_DIR)/Contents/MacOS/
	@cp src/ClaudeNotifier.swift $(INSTALL_DIR)/Contents/MacOS/
	@cp resources/Info.plist $(INSTALL_DIR)/Contents/
	@cp resources/AppIcon.icns $(INSTALL_DIR)/Contents/Resources/
	@echo "Signing app..."
	@codesign --force --deep --sign - $(INSTALL_DIR)
	@echo "Registering with LaunchServices..."
	@$(LSREGISTER) -f $(INSTALL_DIR)
	@echo ""
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "âœ… å®‰è£…å®Œæˆï¼"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "ğŸ“ å®‰è£…è·¯å¾„: $(INSTALL_DIR)"
	@echo ""
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "1ï¸âƒ£  æµ‹è¯•é€šçŸ¥ï¼ˆé¦–æ¬¡è¿è¡Œéœ€æˆæƒé€šçŸ¥æƒé™ï¼‰:"
	@echo "    $(INSTALL_DIR)/Contents/MacOS/$(APP_NAME)"
	@echo ""
	@echo "2ï¸âƒ£  é…ç½® Claude Code Hooksï¼ˆéœ€æ‰‹åŠ¨é…ç½®ï¼‰:"
	@echo "    ç¼–è¾‘ ~/.claude/settings.jsonï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:"
	@echo ""
	@echo '    {'
	@echo '      "hooks": {'
	@echo '        "Stop": [{'
	@echo '          "matcher": "",'
	@echo '          "hooks": [{'
	@echo '            "type": "command",'
	@echo '            "command": "$(INSTALL_DIR)/Contents/MacOS/$(APP_NAME) -t '\''Claude Code'\'' -m '\''Claude å·²å®Œæˆå›ç­”'\''"'
	@echo '          }]'
	@echo '        }]'
	@echo '      }'
	@echo '    }'
	@echo ""
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "ğŸ“– è¯¦ç»†æ–‡æ¡£: https://github.com/zengwenliang416/claude-notifier"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

uninstall:
	@echo "Uninstalling from $(INSTALL_DIR)..."
	@rm -rf $(INSTALL_DIR)
	@echo "Done!"

clean:
	@echo "Cleaning..."
	@rm -f $(APP_NAME)
	@echo "Done!"

help:
	@echo "ClaudeNotifier - macOS notification tool with Claude icon"
	@echo ""
	@echo "Usage:"
	@echo "  make          Build the executable"
	@echo "  make install  Build and install to /Applications"
	@echo "  make uninstall Remove installed app"
	@echo "  make clean    Remove build artifacts"
	@echo "  make help     Show this help"
